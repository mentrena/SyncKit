(self.webpackChunkdocs_synckit=self.webpackChunkdocs_synckit||[]).push([[9004],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=s(n),h=o,f=u["".concat(l,".").concat(h)]||u[h]||d[h]||a;return n?r.createElement(f,i(i({ref:t},p),{},{components:n})):r.createElement(f,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var s=2;s<a;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},970:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return c},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var r=n(2122),o=n(9756),a=(n(7294),n(3905)),i=["components"],c={id:"configuration",title:"Configuration"},l="Configuration",s={unversionedId:"configuration",id:"configuration",isDocsHomePage:!1,title:"Configuration",description:"Record Zone ID",source:"@site/docs/configuration.md",sourceDirName:".",slug:"/configuration",permalink:"/SyncKit/configuration",version:"current",frontMatter:{id:"configuration",title:"Configuration"},sidebar:"docs",previous:{title:"SyncKit for Realm",permalink:"/SyncKit/realm"},next:{title:"Sharing",permalink:"/SyncKit/sharing"}},p=[{value:"Record Zone ID",id:"record-zone-id",children:[]},{value:"When to sync",id:"when-to-sync",children:[]},{value:"CloudKit subscription",id:"cloudkit-subscription",children:[]},{value:"Other notifications",id:"other-notifications",children:[]},{value:"Sync",id:"sync",children:[]},{value:"Model compatibility",id:"model-compatibility",children:[]},{value:"Batch size",id:"batch-size",children:[]},{value:"Adapter configuration",id:"adapter-configuration",children:[]},{value:"Merge policy",id:"merge-policy",children:[]},{value:"Custom record processing",id:"custom-record-processing",children:[]},{value:"CKAsset as Data",id:"ckasset-as-data",children:[]},{value:"hasChanges",id:"haschanges",children:[]},{value:"Encryption",id:"encryption",children:[]}],d={toc:p};function u(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"configuration"},"Configuration"),(0,a.kt)("h3",{id:"record-zone-id"},"Record Zone ID"),(0,a.kt)("p",null,"In the case of the private synchronizer you can optionally specify the name of the CloudKit record zone to use for synchronization. Otherwise the default will be used:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},'CKRecordZone.ID(zoneName: "QSCloudKitCustomZoneName", ownerName: CKCurrentUserDefaultName)\n')),(0,a.kt)("h3",{id:"when-to-sync"},"When to sync"),(0,a.kt)("p",null,"A common question is when to trigger a new sync process. Model adapters will post the ",(0,a.kt)("inlineCode",{parentName:"p"},"ModelAdapterHasChangesNotification")," notification when they detect new changes, so one option is to listen for that to either trigger the sync automatically or to update some UI element to let the user know, in case your app lets the user initiate the sync."),(0,a.kt)("p",null,'This notification is posted only once, when the model adapter goes from "synced" to "changed", rather than for every change that happens.'),(0,a.kt)("h3",{id:"cloudkit-subscription"},"CloudKit subscription"),(0,a.kt)("p",null,"CloudKit supports push notifications to let your app know when changes have been uploaded from another device. You can subscribe for changes in a database:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"synchronizer.subscribeForChangesInDatabase { error in\n  // subscribed\n}\n")),(0,a.kt)("p",null,"Both the private and shared databases support database subscriptions."),(0,a.kt)("p",null,"You can also subscribe for changes in a record zone:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"if let adapter = synchronizer.modelAdapters.first {\n  synchronizer.subscribeForChanges(in: adapter.recordZoneID) { error in\n    // subscribed\n  }\n}\n")),(0,a.kt)("p",null,"Only the private database supports record zone subscriptions."),(0,a.kt)("p",null,"According to Apple you do not need to explicitly enable the Push Notification capability for your app, but you do need to register for remote notifications in your app:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"func application(_ application: UIApplication,\n           didFinishLaunchingWithOptions launchOptions:\n           [UIApplicationLaunchOptionsKey: Any]?) -> Bool {\n   // Override point for customization after application launch.\n               \n   UIApplication.shared.registerForRemoteNotifications()\n   return true\n}\n\nfunc application(_ application: UIApplication, didReceiveRemoteNotification userInfo: [AnyHashable : Any]) {\n  // Do something here, or use the newer UNUserNotificationCenterDelegate methods\n}\n")),(0,a.kt)("p",null,"For more information see the ",(0,a.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/cloudkit/ckrecordzonesubscription"},"Apple documentation")),(0,a.kt)("h3",{id:"other-notifications"},"Other notifications"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"CloudKitSynchronizer")," also posts ",(0,a.kt)("a",{parentName:"p",href:"/api/core/Notification_Name"},"other notifications")," when it's syncing."),(0,a.kt)("h3",{id:"sync"},"Sync"),(0,a.kt)("p",null,"Only one sync process can be active at the same time. If you call ",(0,a.kt)("inlineCode",{parentName:"p"},"synchronize")," while ",(0,a.kt)("inlineCode",{parentName:"p"},"CloudKitSynchronizer")," is already doing so you will receive an ",(0,a.kt)("inlineCode",{parentName:"p"},"alreadySyncing")," ",(0,a.kt)("a",{parentName:"p",href:"/api/core/CloudKitSynchronizer_SyncError"},"error"),"."),(0,a.kt)("h3",{id:"model-compatibility"},"Model compatibility"),(0,a.kt)("p",null,"If you create a new version of your Core Data or Realm model you might want to avoid versions of your app running older versions of the model to get any records that were created under the new model. For that, you can use:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"public var compatibilityVersion: Int\n")),(0,a.kt)("p",null,"When a new model version is created, you can increase the ",(0,a.kt)("inlineCode",{parentName:"p"},"compatibilityVersion")," on the synchronizer. If a synchronizer receives a record from CloudKit that was created by a newer version, the sync process will terminate with a ",(0,a.kt)("inlineCode",{parentName:"p"},"higherModelVersionFound")," error. Do note that the opposite is not true, newer versions of your app might still receive records created by the older version, if the user upgraded the app while it was not fully synced, for example."),(0,a.kt)("h3",{id:"batch-size"},"Batch size"),(0,a.kt)("p",null,"By default ",(0,a.kt)("inlineCode",{parentName:"p"},"CloudKitSynchronizer")," will use a batch size of 200. You can change that number using:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"public var batchSize: Int\n")),(0,a.kt)("p",null,"Regardless of the initial value, if ",(0,a.kt)("inlineCode",{parentName:"p"},"CloudKitSynchronizer")," ever receives a ",(0,a.kt)("inlineCode",{parentName:"p"},"CKError.Code.limitExceeded")," from CloudKit it will reduce the batch size for future operations."),(0,a.kt)("h3",{id:"adapter-configuration"},"Adapter configuration"),(0,a.kt)("p",null,"Model adapters are accessible via the ",(0,a.kt)("inlineCode",{parentName:"p"},"modelAdapters")," property in ",(0,a.kt)("inlineCode",{parentName:"p"},"CloudKitSynchronizer"),", and you can perform further customization on them if you need. A synchronizer for the private database will commonly only have one model adapter, but synchronizers for the shared database will have one model adapter for each record zone that was shared with this user."),(0,a.kt)("h3",{id:"merge-policy"},"Merge policy"),(0,a.kt)("p",null,"Server, local or custom policies are ",(0,a.kt)("a",{parentName:"p",href:"/api/core/MergePolicy"},"available")),(0,a.kt)("p",null,"A custom merge policy is possible by providing a conflict resolution delegate to the model adapter. ",(0,a.kt)("a",{parentName:"p",href:"/api/coredata/CoreDataAdapterConflictResolutionDelegate"},"Core Data"),", ",(0,a.kt)("a",{parentName:"p",href:"/api/realmswift/RealmSwiftAdapterDelegate"},"Realm")),(0,a.kt)("h3",{id:"custom-record-processing"},"Custom record processing"),(0,a.kt)("p",null,"It is possible for your app to customize the way records are created and handled by providing a record processing delegate to your model adapter. This will let you do things like:"),(0,a.kt)("p",null,"Remove specific fields from your records before they're sent to CloudKit.\nRead and write files from the file system to send them as CKAssets, if your model contains references to files in the file system rather than the data itself.\n",(0,a.kt)("a",{parentName:"p",href:"/api/coredata/CoreDataAdapterRecordProcessing"},"Core Data"),"\n",(0,a.kt)("a",{parentName:"p",href:"/api/realmswift/RealmSwiftAdapterRecordProcessing"},"Realm")),(0,a.kt)("h3",{id:"ckasset-as-data"},"CKAsset as Data"),(0,a.kt)("p",null,"By default ",(0,a.kt)("inlineCode",{parentName:"p"},"Data")," properties are uploaded using ",(0,a.kt)("inlineCode",{parentName:"p"},"CKAsset"),", but you can force the use of ",(0,a.kt)("inlineCode",{parentName:"p"},"Data")," by setting:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},"public var forceDataTypeInsteadOfAsset: Bool\n")),(0,a.kt)("h3",{id:"haschanges"},"hasChanges"),(0,a.kt)("p",null,"Model adapters also have a ",(0,a.kt)("inlineCode",{parentName:"p"},"hasChanges")," property that you can check to tell if there are any changes that have not been uploaded to iCloud yet."),(0,a.kt)("h3",{id:"encryption"},"Encryption"),(0,a.kt)("p",null,"Starting on iOS 15 and OSX 12, CloudKit supports ",(0,a.kt)("a",{parentName:"p",href:"https://developer.apple.com/documentation/cloudkit/ckrecord/3746821-encryptedvalues?language=swift"},"encrypted values")," for some of the fields in your objects.\nYou can adopt this with SyncKit by making your model conform to the ",(0,a.kt)("inlineCode",{parentName:"p"},"EncryptedObject")," protocol to return the names of the fields that should be encrypted:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-swift"},'static func encryptedFields() -> [String] {\n  ["secretField", "secretField2"]\n}\n')))}u.isMDXComponent=!0}}]);