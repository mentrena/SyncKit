<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<title data-react-helmet="true">Migrating from SyncKit 0.3.0 | SyncKit</title><meta data-react-helmet="true" property="og:url" content="https://mentrena.github.io/SyncKit/migrating"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Migrating from SyncKit 0.3.0 | SyncKit"><meta data-react-helmet="true" name="description" content="If you were using SyncKit before 0.3.0 and you want to adopt the QSPrimaryKey protocol this page offers some guidance. There are different methods that you could adopt based on your app."><meta data-react-helmet="true" property="og:description" content="If you were using SyncKit before 0.3.0 and you want to adopt the QSPrimaryKey protocol this page offers some guidance. There are different methods that you could adopt based on your app."><link data-react-helmet="true" rel="shortcut icon" href="/SyncKit/img/favicon2.ico"><link data-react-helmet="true" rel="canonical" href="https://mentrena.github.io/SyncKit/migrating"><link data-react-helmet="true" rel="alternate" href="https://mentrena.github.io/SyncKit/migrating" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://mentrena.github.io/SyncKit/migrating" hreflang="x-default"><link rel="stylesheet" href="/SyncKit/assets/css/styles.fe20cb5e.css">
<link rel="preload" href="/SyncKit/assets/js/runtime~main.61c5ad31.js" as="script">
<link rel="preload" href="/SyncKit/assets/js/main.e82329ad.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/SyncKit/"><img src="/SyncKit/img/SyncKit.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/SyncKit/img/SyncKit.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">SyncKit</b></a><a class="navbar__item navbar__link navbar__link--active" href="/SyncKit/">Docs</a><a class="navbar__item navbar__link" href="/SyncKit/api/core/CloudKitSynchronizer">API</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/mentrena/SyncKit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/SyncKit/"><img src="/SyncKit/img/SyncKit.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/SyncKit/img/SyncKit.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">SyncKit</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/SyncKit/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/SyncKit/api/core/CloudKitSynchronizer">API</a></li><li class="menu__list-item"><a href="https://github.com/mentrena/SyncKit" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/example">Example app</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Using SyncKit</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SyncKit/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Core Data</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SyncKit/coredata">SyncKit for Core Data</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/SyncKit/migrating">Migrating from SyncKit 0.3.0</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Realm</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/realm">SyncKit for Realm</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SyncKit/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SyncKit/sharing">Sharing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/architecture">Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SyncKit/faq">FAQ</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="markdown"><header><h1 class="h1Heading_27L5">Migrating from SyncKit 0.3.0</h1></header><p>If you were using SyncKit before 0.3.0 and you want to adopt the <code>QSPrimaryKey</code> protocol this page offers some guidance. There are different methods that you could adopt based on your app.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="existing-primary-key"></a>Existing primary key<a class="hash-link" href="#existing-primary-key" title="Direct link to heading">#</a></h2><p>If your objects already had a populated primary key: Make them implement <code>QSPrimaryKey</code> and call <code>updateTrackingForObjectsWithPrimaryKey</code> on the change manager to make it update its object tracking data so it uses the primary key.</p><ol><li>Add the <code>+ (nonnull NSString *)primaryKey</code> to your classes.</li><li>Update tracking data:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // After launching your app, maybe in didFinishLaunchingWithOptions</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    [self.synchronizer.changeManager updateTrackingForObjectsWithPrimaryKey];</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>Now you can use SyncKit.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="adding-primary-key-field-in-your-model"></a>Adding primary key field in your model<a class="hash-link" href="#adding-primary-key-field-in-your-model" title="Direct link to heading">#</a></h2><p>If you need to change your model to add a primary key then this will require a migration, which would break all the tracking data in SyncKit. To avoid that you can use <code>QSEntityIdentifierUpdateMigrationPolicy</code> as the policy in your mapping model, then call <code>[QSCloudKitSynchronizer updateIdentifierMigrationPolicy];</code> before starting the migration.</p><ol><li>Update your CoreData model and add the required field to those model objects that might need one.</li><li>Create a Core Data mapping model and add entity mappings for you entities.</li><li>In your mapping model, specify <code>QSEntityIdentifierUpdateMigrationPolicy</code> as the Custom Policy. This policy will assign a primary key value to each object being migrated.</li><li>When you create your Core Data stack, check if you need to perform a migration. Sample code:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- (MigrationNeededEnum)isMigrationNecessaryForStore:(NSString *)storePath</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (![[NSFileManager defaultManager] fileExistsAtPath:self.storePath]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return NO;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSError *error = nil;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSDictionary *sourceMetadata = [NSPersistentStoreCoordinator metadataForPersistentStoreOfType:NSSQLiteStoreType</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                              URL:[NSURL fileURLWithPath:storePath]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                          options:@{NSInferMappingModelAutomaticallyOption: @YES,                                  NSMigratePersistentStoresAutomaticallyOption: @YES}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                                                            error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSManagedObjectModel *destinationModel = self.coordinator.managedObjectModel;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ([destinationModel isConfiguration:nil compatibleWithStoreMetadata:sourceMetadata]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return MigrationOptionNoMigration;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSManagedObjectModel *sourceModel = [NSManagedObjectModel mergedModelFromBundles:@[[NSBundle mainBundle]] forStoreMetadata:sourceMetadata];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ([NSMappingModel inferredMappingModelForSourceModel:sourceModel destinationModel:destinationModel error:&amp;error]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        return MigrationOptionLightweightMigration;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return MigrationOptionCustomMigration;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="5"><li>Perform migration. Sample code:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- (void)performBackgroundManagedMigrationForStore:(NSString *)sourceStore</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Show UI</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Show some modal screen with some UIActivityIndicatorView or similar</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Determine if this migration is being run to adopt primary keys, maybe checking [NSManagedObjectModel versionIdentifiers] if you&#x27;ve been setting those on your model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (useSyncKitMigrationPolity) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [QSCloudKitSynchronizer updateIdentifierMigrationPolicy];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Perform migration in the background, so it doesn&#x27;t freeze the UI.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // This way progress can be shown to the user</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0), ^{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        BOOL done = [self migrateStore:sourceStore];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if(done) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            dispatch_async(dispatch_get_main_queue(), ^{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                if (useSyncKitMigrationPolity) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    [QSEntityIdentifierUpdateMigrationPolicy setCoreDataStack:nil];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // Dismiss UI</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                // Load your persistent store</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                [self loadStore];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- (BOOL)migrateStore:(NSString *)sourceStore</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BOOL success = NO;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSError *error = nil;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // STEP 1 - Gather the Source, Destination and Mapping Model</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSURL *storeURL = [NSURL fileURLWithPath:sourceStore];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSDictionary *sourceMetadata = [NSPersistentStoreCoordinator metadataForPersistentStoreOfType:NSSQLiteStoreType URL:storeURL options:nil error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSManagedObjectModel *sourceModel = [NSManagedObjectModel mergedModelFromBundles:nil forStoreMetadata:sourceMetadata];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSManagedObjectModel *destinationModel = self.model;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSMappingModel *mappingModel = [NSMappingModel mappingModelFromBundles:nil forSourceModel:sourceModel destinationModel:destinationModel];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // STEP 2 - Perform migration, assuming the mapping model isn&#x27;t null</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if (mappingModel) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSError *error = nil;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSMigrationManager *migrationManager = [[NSMigrationManager alloc] initWithSourceModel:sourceModel destinationModel:destinationModel];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [migrationManager addObserver:self forKeyPath:@&quot;migrationProgress&quot; options:NSKeyValueObservingOptionNew context:NULL];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSString *destinationStorePath = [[self applicationStoresPath] stringByAppendingPathComponent:@&quot;Temp.sqlite&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        success = [migrationManager migrateStoreFromURL:storeURL</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                   type:NSSQLiteStoreType</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                options:nil</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                       withMappingModel:mappingModel</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                       toDestinationURL:[NSURL fileURLWithPath:destinationStorePath]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                        destinationType:NSSQLiteStoreType</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     destinationOptions:nil</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                                  error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [migrationManager removeObserver:self forKeyPath:@&quot;migrationProgress&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if (success) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // STEP 3 - Replace the old store files with the new migrated store files</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            [self replaceStore:sourceStore withStore:destinationStorePath];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            NSLog(@&quot;FAILED MIGRATION: %@&quot;,error);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSLog(@&quot;FAILED MIGRATION: Mapping Model is null&quot;);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return YES; // indicates migration has finished, regardless of outcome</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ([object isKindOfClass:[NSMigrationManager class]]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        CGFloat progress = [(NSMigrationManager *)object migrationProgress];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        dispatch_async(dispatch_get_main_queue(), ^{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // Update progress indicator UI</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- (BOOL)replaceStore:(NSString *)old withStore:(NSString *)newPath {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BOOL success = NO;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NSError *error = nil;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if ([[NSFileManager defaultManager] fileExistsAtPath:old]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        [[NSFileManager defaultManager] removeItemAtPath:old error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSString *walPath = [old stringByAppendingString:@&quot;-wal&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if ([[NSFileManager defaultManager] fileExistsAtPath:walPath]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            [[NSFileManager defaultManager] removeItemAtPath:walPath error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NSString *shmPath = [old stringByAppendingString:@&quot;-shm&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if ([[NSFileManager defaultManager] fileExistsAtPath:shmPath]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            [[NSFileManager defaultManager] removeItemAtPath:shmPath error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        error = nil;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        if ([[NSFileManager defaultManager] moveItemAtPath:newPath toPath:old error:&amp;error]) {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            NSString *newWalPath = [newPath stringByAppendingString:@&quot;-wal&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            [[NSFileManager defaultManager] moveItemAtPath:newWalPath toPath:walPath error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            NSString *newShmPath = [newPath stringByAppendingString:@&quot;-shm&quot;];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            [[NSFileManager defaultManager] moveItemAtPath:newShmPath toPath:shmPath error:&amp;error];</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            success = YES;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return success;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="6"><li>You can now create your <code>QSCloudKitSynchronizer</code> and use it to sync.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="discarding-current-synckit-tracking-data"></a>Discarding current SyncKit tracking data<a class="hash-link" href="#discarding-current-synckit-tracking-data" title="Direct link to heading">#</a></h2><p>A less optimal, though easier option would be discarding all your existing data when the app performs a migration to add primary key fields, then synchronizing with an empty NSPersistentStore to restore using data currently on iCloud.</p><ol><li>Discard all SyncKit data: </li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly swift"><pre tabindex="0" class="prism-code language-swift codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[self.synchronizer eraseLocal];</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>or, alternatively, delete everything in <code>[QSCloudKitSynchronizer storePath]</code></p><ol start="2"><li>Delete your store file.</li><li>Create a new Core Data stack.</li><li>Create a new <code>QSCloudKitSynchronizer</code>.</li><li>Sync. This will download all the data in iCloud to the new, empty store, so at the end of this the local stack will be a copy of the data on iCloud.</li></ol></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SyncKit/coredata"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« SyncKit for Core Data</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/SyncKit/realm"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SyncKit for Realm Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#existing-primary-key" class="table-of-contents__link">Existing primary key</a></li><li><a href="#adding-primary-key-field-in-your-model" class="table-of-contents__link">Adding primary key field in your model</a></li><li><a href="#discarding-current-synckit-tracking-data" class="table-of-contents__link">Discarding current SyncKit tracking data</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/SyncKit/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Support</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/mentrena/SyncKit/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Report a bug on Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/mentrena/SyncKit" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 SyncKit. Built with Docusaurus.</div></div></div></footer></div>
<script src="/SyncKit/assets/js/runtime~main.61c5ad31.js"></script>
<script src="/SyncKit/assets/js/main.e82329ad.js"></script>
</body>
</html>